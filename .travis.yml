services:
- docker
install:
  - docker login -u=${QUAY_USERNAME} -p=${QUAY_PASSWORD} quay.io
  - make build
stages:
- name: test
- name: publish-release
  if: branch = main AND type != pull_request
- name: publish-staging
  if: branch != main AND type != pull_request
jobs:
  include:
  - stage: test
    name: Test
    script:
    - make validate
  - stage: publish-staging
    name: Publish staging image
    script:
    - make publish-staging
  - stage: publish-release
    name: Publish production image
    script:
    - make publish-release
env:
  global:
  - secure: oirt33xkww2Uojvy/mvtvp7JQmyI9hg1ks5XrsJU6e8lbm6OlFBC2f+OQWBhfYqPSsqKu/lHDaNgvz361gxe6s+SrcJ1FEHkToLOl2425bw5tPMFBB8cJc1RF6KcJSkWRQmiN7Q4Fzh7Kj5Wo8dPuEI6p6UgPinwWVbo0m4Al1rOwGPHDHOkTgdJP7MYKG95o6Q9sm9pyLbuZMHS4nCfZwo6O0o7ds77Fae5BTwQRdzCc6+d+da7oXTGwXrZhqT4Ie+V4/FlA92wevcJwhUb0WWfSe1Dmj3IzDRXaAppVl6qtNesy7Ad9EDfknkqCnWq95gSmJjaoAnbwQzeR+0qirqKj+qpQ6OVq7riuhXcUHikZeZJ870Krmvk04Q53HMNSOaeF/dSclRrTtHK8HruVgAzNXfXyjgNtlqzYiEmShtGFzVB2UX+ybvI2OECi/+1o5RLyXePIUmuMpaXkxPSVNeWHfT4fL7tG8DuDusRABNaoRnQvqpK9av4Z7wzoIe0N5Y5UxmAPC30Ce9sjOEoyZwp8H7mB8eVB2dyio69RPepzuZNCj7RYMwR3fGlzUrtJhbUe2/ZoqdcE5mQsev0lFHB9hKgr1H34IQ1WOqjAIB7n1tcDrZPLBKxV+UqKEpq9K1lCnMidC30Ryj1br/qPwFJZd8YtVZUn+xatQ/w68s=
  - secure: FLjAe67XslDsQmJrEynss/t4OIZxU/gbgYdygYMxDmc27HnF8Vef1MSBaKvut3l4Jw20UPh1+ovrB8Df7HWCawW7UIDzJZvNil5BOnUkCi1I0sRdwHIHgpLTavwxtTOr/bOqKZotmYXTuz0RCQTxXkNsQ3sN3m9E/oyoHzAe4bkmIDlfGZeC4wIJ6Cvg2B/Ze3bPEHrizr+q3XWt4Yj++wjOUmr08j9PNiwpaJW/M4PDp5IIsF9cP6hLw2LWX9UmEsMRmItuGupSyhdz6fqKrSMTz93HrnfQ8i8HmklT8Bq9AHtc26NbH1bpCiYGxuj0Umdle/FbAB3ccujBxyTM0N9A1q+bMqbJN+v8cN284I+5PEPLhQ71U7bh+siUNmGO2+FWKeowL6YDhromDRAvPCK0++H1Gw39dPuHPvw53dhbBnZyZCkZea2Xr3DWwQcdmv0syvhEH6yZRQJNIZ0flYSSS6HJ2BNxikVN2LkCkus250dy6nJEhNDzJd02VWpD+7SwC5ZNBBEMZ2Fqwq4At5JYvco04gnTfVfHJL0uH6Wpznmz/bz8xw9IbCkRqd9F0ePu0bptC+xe7YHMv6N8LIv8ndYbTKIHv9fCpbdC/H6t00oJnXEQtfAGfcW8G+pi+/Tao3CV9WuElHM2CAPok9MNkVyhnt+uvxUqrCZD3Zs=
